(function(){"use strict";function M(t){const s=1-t(),n=1-t();return Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*n)}async function C(t,s){const n=Math.random,o=[],e=Math.max(1,t.diskRadius),E=e*.98,A=Math.max(1,t.armCount);for(let r=0;r<t.starCount;r++){const m=Math.floor(n()*A),g=e*Math.pow(n(),1.6),u=m*Math.PI*2/A,f=t.armTwist*(g/e),R=M(n)*t.armSpread,b=u+f+R,w=M(n)*t.noise*e*.25,l=c(g+w,.05,E),a=l*Math.cos(b),x=l*Math.sin(b),v=M(n)*t.verticalThickness,p=l/e,q=Math.pow(Math.max(0,1-p),t.coreFalloff);let h=t.brightness*q;h+=n()*.04-.02,h=c(h,.003,Number.MAX_VALUE);let z=Math.pow(h,.7);z+=(n()-.5)*(1/255);const P=c(z,0,1);o.push(a,v,x,h,P)}const i=Math.random,y=Math.max(.1,t.bulgeRadius),I=.1,k=1/I,F=1/y,N=k-F;for(let r=0;r<t.bulgeStarCount;r++){const m=i(),g=k-m*N,u=c(1/g,I,y),f=i()*Math.PI*2,R=t.verticalThickness*t.bulgeVerticalScale,b=M(i)*R,w=u*Math.cos(f),l=u*Math.sin(f);let a=t.bulgeBrightness*Math.pow(1-u/y,t.bulgeFalloff);a+=i()*.08-.04,a=c(a,.05,Number.MAX_VALUE);let x=Math.pow(a,.6);x+=(i()-.5)*(1/255);const v=c(x,0,1);o.push(w,b,l,a,v)}const S=new Float32Array(o);return{data:S,count:S.length/5}}function c(t,s,n){return Math.min(Math.max(t,s),n)}const d=self;d.onmessage=async t=>{const s=t.data;if(s.type==="terminate"){d.close();return}if(s.type==="generate")try{const n=await C(s.params),o=n.data.buffer,e={type:"result",id:s.id,count:n.count,buffer:o};d.postMessage(e,[o])}catch(n){const o=n instanceof Error?n.message:String(n);d.postMessage({type:"error",id:s.id,message:o})}}})();
